#!/usr/bin/env ruby
require_relative "../config/environment"
require "listen"

FILE_PATH = "game_log_large.txt"

FileUtils.touch(FILE_PATH) unless File.exist?(FILE_PATH)

puts "ğŸ‘€ De olho no arquivo: #{FILE_PATH}..."

listener = Listen.to(".", only: /#{FILE_PATH}$/) do
  puts "ğŸ“ Opa, mudou! Importando #{Time.now.strftime('%H:%M:%S')}..."
  
  LogImporterService.new(FILE_PATH).call
  
  puts "âœ… Finalizado."
end

listener.start
sleep
